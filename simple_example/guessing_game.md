# ç¼–å†™çŒœæ•°å­—æ¸¸æˆ

[TOC]

å®žçŽ°ä¸€ä¸ªç»å…¸çš„æ–°æ‰‹ç¼–ç¨‹é—®é¢˜ï¼šçŒœæ•°å­—æ¸¸æˆã€‚

å®ƒæ˜¯è¿™ä¹ˆå·¥ä½œçš„ï¼šç¨‹åºå°†ä¼šéšæœºç”Ÿæˆä¸€ä¸ª 1 åˆ° 100 ä¹‹é—´çš„éšæœºæ•´æ•°ã€‚æŽ¥ç€å®ƒä¼šè¯·çŽ©å®¶çŒœä¸€ä¸ªæ•°å¹¶è¾“å…¥ï¼Œç„¶åŽæç¤ºçŒœæµ‹æ˜¯å¤§äº†è¿˜æ˜¯å°äº†ã€‚å¦‚æžœçŒœå¯¹äº†ï¼Œå®ƒä¼šæ‰“å°ç¥è´ºä¿¡æ¯å¹¶é€€å‡ºã€‚

## åˆ›å»ºé¡¹ç›®ç›®å½•

åœ¨ *projects* ç›®å½•ï¼Œä½¿ç”¨ Cargo æ–°å»ºä¸€ä¸ªé¡¹ç›®ï¼Œå¦‚ä¸‹ï¼š

```shell
$ cargo new guessing_game
$ cd guessing_game
```

## å¤„ç†ä¸€æ¬¡çŒœæµ‹

æç¤ºç”¨æˆ·è¾“å…¥çŒœæµ‹ï¼ŒèŽ·å–ç”¨æˆ·çŒœæµ‹å¹¶æ‰“å°å‡ºæ¥ã€‚

æ–‡ä»¶åï¼šsrc/main.rs

```rust
use std::io;//--ä»Žæ ‡å‡†åº“ä¸­å¼•å…¥è¾“å…¥/è¾“å‡ºåŠŸèƒ½

fn main() {
    println!("Guess the number!");//--æç¤ºä¿¡æ¯

    println!("Please input your guess.");//--æç¤ºç”¨æˆ·è¾“å…¥

    let mut guess = String::new();//--å®šä¹‰å˜é‡æŽ¥æ”¶ç”¨æˆ·çš„è¾“å…¥

    //--ç”¨å˜é‡æŽ¥æ”¶ç”¨æˆ·çš„è¾“å…¥
    io::stdin()
        .read_line(&mut guess)
        .expect("Failed to read line");

    println!("You guessed: {}", guess);//--å°†ç”¨æˆ·è¾“å…¥çš„çŒœæµ‹æ‰“å°åˆ°å±å¹•
}
```

ç¤ºä¾‹ 2-1ï¼šèŽ·å–ç”¨æˆ·çŒœæµ‹å¹¶æ‰“å°çš„ä»£ç 

### é€è¡Œè§£è¯»ä»£ç 

#### å¼•å…¥io

```rust
use std::io;
```

é»˜è®¤æƒ…å†µä¸‹ï¼ŒRustä¼šå°†å°‘é‡æ ‡å‡†åº“ä¸­å®šä¹‰çš„ç¨‹åºé¡¹ï¼ˆitemï¼‰å¼•å…¥åˆ°æ¯ä¸ªç¨‹åºçš„ä½œç”¨åŸŸä¸­ã€‚è¿™äº›é¡¹ç§°ä½œ *prelude*ã€‚

å¦‚æžœéœ€è¦çš„ç±»åž‹ä¸åœ¨ prelude ä¸­ï¼Œä½ å¿…é¡»ä½¿ç”¨ `use` è¯­å¥æ˜¾å¼åœ°å°†å…¶å¼•å…¥ä½œç”¨åŸŸã€‚

`std::io` åº“æä¾›å¾ˆå¤šæœ‰ç”¨çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬æŽ¥æ”¶ç”¨æˆ·è¾“å…¥çš„åŠŸèƒ½ã€‚

#### ç¨‹åºå…¥å£

```rust
fn main() {
```

`main` å‡½æ•°æ˜¯ç¨‹åºçš„å…¥å£ç‚¹ã€‚

`fn` è¯­æ³•å£°æ˜Žäº†ä¸€ä¸ªæ–°å‡½æ•°ï¼Œå°æ‹¬å· `()` è¡¨æ˜Žæ²¡æœ‰å‚æ•°ï¼Œå¤§æ‹¬å· `{` ä½œä¸ºå‡½æ•°ä½“çš„å¼€å§‹ã€‚

```rust
    println!("Guess the number!");

    println!("Please input your guess.");
```

è¿™äº›ä»£ç ä»…ä»…æ‰“å°æç¤ºï¼Œä»‹ç»æ¸¸æˆçš„å†…å®¹ç„¶åŽè¯·æ±‚ç”¨æˆ·è¾“å…¥ã€‚

#### å®šä¹‰å˜é‡

```rust
    let mut guess = String::new();
```

åˆ›å»ºä¸€ä¸ªå‚¨å­˜ç”¨æˆ·è¾“å…¥çš„**å˜é‡**ï¼ˆ*variable*ï¼‰

> æˆ‘ä»¬ä½¿ç”¨ `let` å£°æ˜Žæ¥åˆ›å»ºå˜é‡ã€‚
>
> åœ¨ Rust ä¸­ï¼Œå˜é‡é»˜è®¤æ˜¯**ä¸å¯å˜**çš„ã€‚
>
> åœ¨å˜é‡åå‰ä½¿ç”¨ `mut` æ¥ä½¿ä¸€ä¸ªå˜é‡å¯å˜ã€‚

ä¾‹å¦‚ï¼š

```rust
let apples = 5; // ä¸å¯å˜
let mut bananas = 5; // å¯å˜
```

> æ³¨æ„ï¼š`//` è¯­æ³•å¼€å§‹ä¸€ä¸ªæ³¨é‡Šï¼ŒæŒç»­åˆ°è¡Œå°¾ã€‚Rust å¿½ç•¥æ³¨é‡Šä¸­çš„æ‰€æœ‰å†…å®¹ï¼Œ[ç¬¬ 3 ç« ](https://rustwiki.org/zh-CN/book/ch03-04-comments.html)å°†ä¼šè¯¦ç»†ä»‹ç»æ³¨é‡Šã€‚

çŽ°åœ¨æˆ‘ä»¬çŸ¥é“äº† `let mut guess` ä¼šå¼•å…¥ä¸€ä¸ªå«åš `guess` çš„å¯å˜å˜é‡ã€‚ç­‰å·ï¼ˆ`=`ï¼‰å‘Šè¯‰ Rust çŽ°åœ¨æƒ³å°†æŸä¸ªå€¼ç»‘å®šåœ¨å˜é‡ä¸Šã€‚ç­‰å·çš„å³è¾¹æ˜¯ `guess` æ‰€ç»‘å®šçš„å€¼ï¼Œå®ƒæ˜¯ `String::new` çš„ç»“æžœï¼Œè¿™ä¸ªå‡½æ•°ä¼šè¿”å›žä¸€ä¸ª `String` çš„æ–°å®žä¾‹ã€‚`String` æ˜¯ä¸€ä¸ªæ ‡å‡†åº“æä¾›çš„å­—ç¬¦ä¸²ç±»åž‹ï¼Œè¿™æ˜¯ UTF-8 ç¼–ç çš„å¯å¢žé•¿æ–‡æœ¬å—ã€‚

> `::new` é‚£ä¸€è¡Œçš„ `::` è¯­æ³•è¡¨æ˜Ž `new` æ˜¯ `String` ç±»åž‹çš„ä¸€ä¸ªå…³è”å‡½æ•°ã€‚
>
> **å…³è”å‡½æ•°**ï¼ˆ*associated function*ï¼‰æ˜¯å®žçŽ°ä¸€ç§ç‰¹å®šç±»åž‹çš„å‡½æ•°ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ç±»åž‹æ˜¯ `String`ã€‚
>
> è¿™ä¸ª `new` å‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ç©ºå­—ç¬¦ä¸²ï¼Œä½ ä¼šå‘çŽ°å¾ˆå¤šç±»åž‹ä¸Šæœ‰ `new` å‡½æ•°ï¼Œå› ä¸ºå®ƒæ˜¯åˆ›å»ºç±»åž‹å®žä¾‹çš„æƒ¯ç”¨å‡½æ•°åã€‚

æ€»çš„æ¥è¯´ï¼Œ`let mut guess = String::new();` è¿™ä¸€è¡Œåˆ›å»ºäº†ä¸€ä¸ªå¯å˜å˜é‡ï¼Œå½“å‰å®ƒç»‘å®šåˆ°ä¸€ä¸ªæ–°çš„ `String` ç©ºå®žä¾‹ä¸Šã€‚

#### è¯»å–ç”¨æˆ·è¾“å…¥

```rust
    io::stdin()
        .read_line(&mut guess)
```

æˆ‘ä»¬åœ¨ç¨‹åºçš„ç¬¬ä¸€è¡Œä½¿ç”¨ `use std::io;` ä»Žæ ‡å‡†åº“ä¸­å¼•å…¥äº†è¾“å…¥/è¾“å‡ºåŠŸèƒ½ã€‚çŽ°åœ¨è°ƒç”¨å¯ä»¥ä½¿æˆ‘ä»¬å¤„ç†ç”¨æˆ·è¾“å…¥çš„ `io` åº“ä¸­çš„å‡½æ•° `stdin`ã€‚

å¦‚æžœç¨‹åºçš„å¼€å¤´æ²¡æœ‰ä½¿ç”¨ `use std::io` å¼•å…¥ `io` åº“ï¼Œæˆ‘ä»¬ä»å¯ä»¥é€šè¿‡æŠŠå‡½æ•°è°ƒç”¨å†™æˆ `std::io::stdin` æ¥ä½¿ç”¨å‡½æ•°ã€‚`stdin` å‡½æ•°è¿”å›žä¸€ä¸ª [`std::io::Stdin`](https://rustwiki.org/zh-CN/std/io/struct.Stdin.html) çš„å®žä¾‹ï¼Œè¿™ä»£è¡¨ç»ˆç«¯æ ‡å‡†è¾“å…¥å¥æŸ„çš„ç±»åž‹ã€‚

æŽ¥ä¸‹æ¥ï¼Œ`.read_line(&mut guess)` è¿™ä¸€è¡Œè°ƒç”¨äº† [`read_line`](https://rustwiki.org/zh-CN/std/io/struct.Stdin.html#method.read_line) æ–¹æ³•ä»Žæ ‡å‡†è¾“å…¥å¥æŸ„èŽ·å–ç”¨æˆ·è¾“å…¥ã€‚æˆ‘ä»¬è¿˜å°† `&mut guess` ä½œä¸ºå‚æ•°ä¼ é€’ç»™ `read_line()`ï¼Œä»¥å‘Šè¯‰å®ƒåœ¨å“ªä¸ªå­—ç¬¦ä¸²å­˜å‚¨ç”¨æˆ·è¾“å…¥ã€‚`read_line` çš„å…¨éƒ¨å·¥ä½œæ˜¯ï¼Œæ— è®ºç”¨æˆ·åœ¨æ ‡å‡†è¾“å…¥ä¸­é”®å…¥ä»€ä¹ˆå†…å®¹ï¼Œéƒ½å°†å…¶å­˜å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ï¼ˆä¸è¦†ç›–å…¶å†…å®¹ï¼‰ï¼Œæ‰€ä»¥å®ƒéœ€è¦å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ã€‚è¿™ä¸ªå­—ç¬¦ä¸²å‚æ•°éœ€è¦æ˜¯å¯å˜çš„ï¼Œä»¥ä¾¿è¯¥æ–¹æ³•å¯ä»¥æ›´æ”¹å­—ç¬¦ä¸²çš„å†…å®¹ã€‚

> `&` è¡¨ç¤ºè¿™ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª**å¼•ç”¨**ï¼ˆ*reference*ï¼‰ï¼Œå®ƒå…è®¸å¤šå¤„ä»£ç è®¿é—®åŒä¸€å¤„æ•°æ®ï¼Œè€Œæ— éœ€åœ¨å†…å­˜ä¸­å¤šæ¬¡æ‹·è´ã€‚
>
> å¼•ç”¨æ˜¯ä¸€ä¸ªå¤æ‚çš„ç‰¹æ€§ï¼ŒRust çš„ä¸€ä¸ªä¸»è¦ä¼˜åŠ¿å°±æ˜¯å®‰å…¨è€Œç®€å•çš„æ“ä½œå¼•ç”¨ã€‚
>
> å°±åƒå˜é‡ä¸€æ ·ï¼Œå¼•ç”¨é»˜è®¤æ˜¯ä¸å¯å˜çš„ã€‚å› æ­¤ï¼Œéœ€è¦å†™æˆ `&mut guess` æ¥ä½¿å…¶å¯å˜ï¼Œè€Œä¸æ˜¯ `&guess`ã€‚
>

#### å¤„ç†æ½œåœ¨é”™è¯¯

```rust
        .expect("Failed to read line");
```

ä½¿ç”¨ Result ç±»åž‹æ¥å¤„ç†æ½œåœ¨çš„é”™è¯¯

 `read_line` å°†ç”¨æˆ·è¾“å…¥æ”¾ç½®åˆ°ä¼ é€’ç»™å®ƒçš„å­—ç¬¦ä¸²ä¸­ï¼Œä¸è¿‡å®ƒä¹Ÿè¿”å›žä¸€ä¸ªå€¼â€”â€”åœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯ [`io::Result`](https://rustwiki.org/zh-CN/std/io/type.Result.html)ã€‚Rust æ ‡å‡†åº“ä¸­æœ‰å¾ˆå¤šå«åš `Result` çš„ç±»åž‹ï¼šä¸€ä¸ªé€šç”¨çš„ [`Result`](https://rustwiki.org/zh-CN/std/result/enum.Result.html) ä»¥åŠåœ¨å­æ¨¡å—ä¸­çš„ç‰¹åŒ–ç‰ˆæœ¬ï¼Œæ¯”å¦‚ `io::Result`ã€‚`Result` ç±»åž‹æ˜¯ [*æžšä¸¾*ï¼ˆ*enumerations*ï¼‰](https://rustwiki.org/zh-CN/book/ch06-00-enums.html)ï¼Œé€šå¸¸ä¹Ÿå†™ä½œ *enum*ã€‚æžšä¸¾ç±»åž‹æŒæœ‰å›ºå®šé›†åˆçš„å€¼ï¼Œè¿™äº›å€¼è¢«ç§°ä¸ºæžšä¸¾çš„**æˆå‘˜**ï¼ˆ*variant*ï¼‰ã€‚æžšä¸¾å¾€å¾€ä¸Žæ¡ä»¶è¡¨è¾¾å¼ `match` ä¸€èµ·ä½¿ç”¨ï¼Œå¯ä»¥æ–¹ä¾¿åœ°æ ¹æ®æžšä¸¾å€¼æ˜¯å“ªä¸ªæˆå‘˜æ¥æ‰§è¡Œä¸åŒçš„ä»£ç ã€‚

> `Result` çš„æˆå‘˜æ˜¯ `Ok` å’Œ `Err`ã€‚
>
> `Ok` æˆå‘˜è¡¨ç¤ºæ“ä½œæˆåŠŸï¼Œå†…éƒ¨åŒ…å«æˆåŠŸæ—¶äº§ç”Ÿçš„å€¼ã€‚
>
> `Err` æˆå‘˜åˆ™æ„å‘³ç€æ“ä½œå¤±è´¥ï¼Œå¹¶ä¸”åŒ…å«å¤±è´¥çš„å‰å› åŽæžœã€‚

è¿™äº› `Result` ç±»åž‹çš„ä½œç”¨æ˜¯ç¼–ç é”™è¯¯å¤„ç†ä¿¡æ¯ã€‚`Result` ç±»åž‹çš„å€¼ï¼Œåƒå…¶ä»–ç±»åž‹ä¸€æ ·ï¼Œæ‹¥æœ‰å®šä¹‰äºŽå…¶ä¸Šçš„æ–¹æ³•ã€‚`io::Result` çš„å®žä¾‹æ‹¥æœ‰ [`expect` æ–¹æ³•](https://rustwiki.org/zh-CN/std/result/enum.Result.html#method.expect)ã€‚å¦‚æžœ `io::Result` å®žä¾‹çš„å€¼æ˜¯ `Err`ï¼Œ`expect` ä¼šå¯¼è‡´ç¨‹åºå´©æºƒï¼Œå¹¶æ˜¾ç¤ºå½“åšå‚æ•°ä¼ é€’ç»™ `expect` çš„ä¿¡æ¯ã€‚

> å¦‚æžœ `read_line` æ–¹æ³•è¿”å›ž `Err`ï¼Œåˆ™å¯èƒ½æ˜¯æ¥æºäºŽåº•å±‚æ“ä½œç³»ç»Ÿé”™è¯¯çš„ç»“æžœã€‚
>
> å¦‚æžœ `io::Result` å®žä¾‹çš„å€¼æ˜¯ `Ok`ï¼Œ`expect` ä¼šèŽ·å– `Ok` ä¸­çš„å€¼å¹¶åŽŸæ ·è¿”å›žã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œè¿™ä¸ªå€¼æ˜¯ç”¨æˆ·è¾“å…¥çš„å­—èŠ‚æ•°ã€‚

å¦‚æžœä¸è°ƒç”¨ `expect`ï¼Œç¨‹åºä¹Ÿèƒ½ç¼–è¯‘ï¼Œä¸è¿‡ä¼šå‡ºçŽ°ä¸€ä¸ªè­¦å‘Šï¼š

```shell
$ cargo build
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
warning: unused `Result` that must be used
  --> src/main.rs:10:5
   |
10 |     io::stdin().read_line(&mut guess);
   |     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   |
   = note: `#[warn(unused_must_use)]` on by default
   = note: this `Result` may be an `Err` variant, which should be handled

warning: `guessing_game` (bin "guessing_game") generated 1 warning
    Finished dev [unoptimized + debuginfo] target(s) in 0.59s

```

Rust è­¦å‘Šæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ `read_line` çš„è¿”å›žå€¼ `Result`ï¼Œè¯´æ˜Žæœ‰ä¸€ä¸ªå¯èƒ½çš„é”™è¯¯æ²¡æœ‰å¤„ç†ã€‚

æ¶ˆé™¤è­¦å‘Šçš„æ­£ç¡®åšæ³•æ˜¯å®žé™…ç¼–å†™é”™è¯¯å¤„ç†ä»£ç ï¼Œä¸è¿‡ç”±äºŽæˆ‘ä»¬å°±æ˜¯å¸Œæœ›ç¨‹åºåœ¨å‡ºçŽ°é—®é¢˜æ—¶ç«‹å³å´©æºƒï¼Œæ‰€ä»¥ç›´æŽ¥ä½¿ç”¨ `expect`ã€‚

#### æ‰“å°ç”¨æˆ·è¾“å…¥å­—ç¬¦

```rust
    println!("You guessed: {}", guess);
```

æ‰“å°äº†å­˜å‚¨ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ä¸²ã€‚

> é‡Œé¢çš„ `{}` æ˜¯é¢„ç•™åœ¨ç‰¹å®šä½ç½®çš„å ä½ç¬¦ï¼š
>
> æŠŠ `{}` æƒ³è±¡æˆå°èŸ¹é’³ï¼Œå¯ä»¥å¤¹ä½åˆé€‚çš„å€¼ã€‚ä½¿ç”¨ `{}` ä¹Ÿå¯ä»¥æ‰“å°å¤šä¸ªå€¼ï¼š
>
> ç¬¬ä¸€å¯¹ `{}` ä½¿ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²ä¹‹åŽçš„ç¬¬ä¸€ä¸ªå€¼ï¼Œç¬¬äºŒå¯¹åˆ™ä½¿ç”¨ç¬¬äºŒä¸ªå€¼ï¼Œä¾æ­¤ç±»æŽ¨ã€‚

```rust
let x = 5;
let y = 10;

println!("x = {} and y = {}", x, y);
```

è¿™è¡Œä»£ç ä¼šæ‰“å°å‡º `x = 5 and y = 10`ã€‚

## ç”Ÿæˆä¸€ä¸ªéšæœºæ•°å­—

Rust æ ‡å‡†åº“ä¸­å°šæœªåŒ…å«éšæœºæ•°åŠŸèƒ½ã€‚ä½†æ˜¯ï¼ŒRust å›¢é˜Ÿè¿˜æ˜¯æä¾›äº†ä¸€ä¸ªåŒ…å«ä¸Šè¿°åŠŸèƒ½çš„ [`rand` crate](https://crates.io/crates/rand)ã€‚

### ä½¿ç”¨ crate æ¥å¢žåŠ æ›´å¤šåŠŸèƒ½

> *crate* æ˜¯ä¸€ä¸ª Rust ä»£ç åŒ…ã€‚
>
> æˆ‘ä»¬æ­£åœ¨æž„å»ºçš„é¡¹ç›®æ˜¯ä¸€ä¸ª **äºŒè¿›åˆ¶ crate**ï¼Œå®ƒç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ã€‚ 
>
> `rand` crate æ˜¯ä¸€ä¸ª **åº“ crate**ï¼Œåº“ crate å¯ä»¥åŒ…å«ä»»æ„èƒ½è¢«å…¶ä»–ç¨‹åºä½¿ç”¨çš„ä»£ç ï¼Œä½†æ˜¯ä¸èƒ½ç‹¬è‡ªæ‰§è¡Œã€‚

Cargo å¯¹å¤–éƒ¨ crate çš„è¿ç”¨æ˜¯å…¶çœŸæ­£çš„äº®ç‚¹æ‰€åœ¨ã€‚åœ¨æˆ‘ä»¬ä½¿ç”¨ `rand` ç¼–å†™ä»£ç ä¹‹å‰ï¼Œéœ€è¦ä¿®æ”¹ *Cargo.toml* æ–‡ä»¶ï¼Œå¼•å…¥ä¸€ä¸ª `rand` ä¾èµ–ã€‚çŽ°åœ¨æ‰“å¼€è¿™ä¸ªæ–‡ä»¶å¹¶å°†ä¸‹é¢è¿™ä¸€è¡Œæ·»åŠ åˆ° `[dependencies]` è¡¨å—æ ‡é¢˜ä¹‹ä¸‹ã€‚è¯·ç¡®ä¿æŒ‰ç…§æˆ‘ä»¬è¿™é‡Œçš„æ–¹å¼æŒ‡å®š `rand` åŠå…¶è¿™é‡Œç»™å‡ºçš„ç‰ˆæœ¬å·ï¼Œå¦åˆ™æœ¬æ•™ç¨‹ä¸­çš„ç¤ºä¾‹ä»£ç å¯èƒ½æ— æ³•å·¥ä½œã€‚

#### ä¿®æ”¹Cargo.toml

æ–‡ä»¶åï¼šCargo.toml

```toml
rand = "0.8.3"
```

> åœ¨ *Cargo.toml* æ–‡ä»¶ä¸­ï¼Œè¡¨å¤´ä»¥åŠä¹‹åŽçš„å†…å®¹å±žåŒä¸€ä¸ªè¡¨å—ï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ªè¡¨å¤´æ‰å¼€å§‹æ–°çš„è¡¨å—ã€‚
>
> åœ¨ `[dependencies]` è¡¨å—ä¸­ï¼Œä½ è¦å‘Šè¯‰ Cargo æœ¬é¡¹ç›®ä¾èµ–äº†å“ªäº›å¤–éƒ¨ crate åŠå…¶ç‰ˆæœ¬ã€‚

> æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬ `0.8.3` æ¥æŒ‡å®š `rand` crateã€‚
>
> Cargo ç†è§£[è¯­ä¹‰åŒ–ç‰ˆæœ¬](http://semver.org/)ï¼ˆSemantic Versioningï¼Œæœ‰æ—¶ä¹Ÿç§°ä¸º *SemVer*ï¼‰ï¼Œè¿™æ˜¯ä¸€ç§å®šä¹‰ç‰ˆæœ¬å·çš„æ ‡å‡†ã€‚
>
> `0.8.3` å®žé™…ä¸Šæ˜¯ `^0.8.3` çš„ç®€å†™ï¼Œå®ƒè¡¨ç¤ºä»»ä½•è‡³å°‘åŒ…å« `0.8.3` ä½†ä½ŽäºŽ `0.9.0` çš„ç‰ˆæœ¬ã€‚ Cargo è®¤ä¸ºè¿™äº›ç‰ˆæœ¬å…·æœ‰ä¸Ž `0.8.3` ç‰ˆæœ¬å…¼å®¹çš„å…¬æœ‰ APIï¼Œ å¹¶ä¸”æ­¤è§„èŒƒå¯ç¡®ä¿ä½ å°†èŽ·å¾—æœ€æ–°çš„è¡¥ä¸ç‰ˆæœ¬ï¼Œå®ƒä»ç„¶å¯ä»¥ä¸Žæœ¬ç« ä¸­çš„ä»£ç æ­£å¸¸ç¼–è¯‘ã€‚`0.9.0` æˆ–æ›´é«˜ç‰ˆæœ¬åˆ™ä¸å†ç¡®ä¿ API å’Œä»¥ä¸‹ç¤ºä¾‹æ‰€ä½¿ç”¨çš„ API ç›¸åŒã€‚

#### æž„å»ºé¡¹ç›®

çŽ°åœ¨ï¼Œä¸ä¿®æ”¹ä»»ä½•ä»£ç å°±å¯ä»¥æž„å»ºé¡¹ç›®

```shell
$ cargo build
    Updating crates.io index
  Downloaded rand v0.8.3
  Downloaded libc v0.2.86
  Downloaded getrandom v0.2.2
  Downloaded cfg-if v1.0.0
  Downloaded ppv-lite86 v0.2.10
  Downloaded rand_chacha v0.3.0
  Downloaded rand_core v0.6.2
   Compiling rand_core v0.6.2
   Compiling libc v0.2.86
   Compiling getrandom v0.2.2
   Compiling cfg-if v1.0.0
   Compiling ppv-lite86 v0.2.10
   Compiling rand_chacha v0.3.0
   Compiling rand v0.8.3
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
    Finished dev [unoptimized + debuginfo] target(s) in 2.53s

```

å¯èƒ½ä¼šå‡ºçŽ°ä¸åŒçš„ç‰ˆæœ¬å·ï¼ˆå¤šäºäº†è¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼Œå®ƒä»¬ä¸Žä»£ç æ˜¯å…¼å®¹çš„ï¼ï¼‰ï¼ŒåŒæ—¶æ˜¾ç¤ºé¡ºåºä¹Ÿå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚

å½“æˆ‘ä»¬å¼•å…¥äº†ä¸€ä¸ªå¤–éƒ¨ä¾èµ–åŽï¼ŒCargo å°†ä»Ž *registry* ä¸ŠèŽ·å–æ‰€æœ‰ä¾èµ–æ‰€éœ€çš„æœ€æ–°ç‰ˆæœ¬ï¼Œè¿™æ˜¯ä¸€ä»½æ¥è‡ª [Crates.io](https://crates.io/) çš„æ•°æ®æ‹·è´ã€‚Crates.io æ˜¯ Rust ç”Ÿæ€çŽ¯å¢ƒä¸­å¼€å‘è€…ä»¬å‘ä»–äººè´¡çŒ® Rust å¼€æºé¡¹ç›®çš„åœ°æ–¹ã€‚

åœ¨æ›´æ–°å®Œ registry åŽï¼ŒCargo æ£€æŸ¥ `[dependencies]` è¡¨å—å¹¶ä¸‹è½½ç¼ºå¤±çš„ crate ã€‚æœ¬ä¾‹ä¸­ï¼Œè™½ç„¶åªå£°æ˜Žäº† `rand` ä¸€ä¸ªä¾èµ–ï¼Œç„¶è€Œ Cargo è¿˜æ˜¯é¢å¤–èŽ·å–äº† `rand` æ‰€éœ€çš„å…¶ä»– crateï¼Œ`rand` ä¾èµ–å®ƒä»¬æ¥æ­£å¸¸å·¥ä½œã€‚ä¸‹è½½å®ŒæˆåŽï¼ŒRust ç¼–è¯‘ä¾èµ–ï¼Œç„¶åŽä½¿ç”¨è¿™äº›ä¾èµ–ç¼–è¯‘é¡¹ç›®ã€‚

å¦‚æžœä¸åšä»»ä½•ä¿®æ”¹ï¼Œç«‹åˆ»å†æ¬¡è¿è¡Œ `cargo build`ï¼Œåˆ™ä¸ä¼šçœ‹åˆ°ä»»ä½•é™¤äº† `Finished` è¡Œä¹‹å¤–çš„è¾“å‡ºã€‚Cargo çŸ¥é“å®ƒå·²ç»ä¸‹è½½å¹¶ç¼–è¯‘äº†ä¾èµ–ï¼ŒåŒæ—¶ *Cargo.toml* æ–‡ä»¶ä¹Ÿæ²¡æœ‰å˜åŠ¨ã€‚Cargo è¿˜çŸ¥é“ä»£ç ä¹Ÿæ²¡æœ‰ä»»ä½•ä¿®æ”¹ï¼Œæ‰€ä»¥å®ƒä¸ä¼šé‡æ–°ç¼–è¯‘ä»£ç ã€‚å› ä¸ºæ— äº‹å¯åšï¼Œå®ƒç®€å•çš„é€€å‡ºäº†ã€‚

#### ä¿®æ”¹main.rs æ–‡ä»¶åŽå†æ¬¡æž„å»º

å¦‚æžœæ‰“å¼€ *src/main.rs* æ–‡ä»¶ï¼Œåšä¸€äº›æ— å…³ç´§è¦çš„ä¿®æ”¹ï¼Œä¿å­˜å¹¶å†æ¬¡æž„å»ºï¼Œåˆ™ä¼šå‡ºçŽ°ä¸¤è¡Œè¾“å‡ºï¼š

```shell
$ cargo build
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
    Finished dev [unoptimized + debuginfo] target(s) in 2.53 secs
```

è¿™ä¸€è¡Œè¡¨ç¤º Cargo åªé’ˆå¯¹ *src/main.rs* æ–‡ä»¶çš„å¾®å°ä¿®æ”¹è€Œæ›´æ–°æž„å»ºã€‚ä¾èµ–æ²¡æœ‰å˜åŒ–ï¼Œæ‰€ä»¥ Cargo çŸ¥é“å®ƒå¯ä»¥å¤ç”¨å·²ç»ä¸ºæ­¤ä¸‹è½½å¹¶ç¼–è¯‘çš„ä»£ç ã€‚

#### Cargo.lock æ–‡ä»¶ç¡®ä¿æž„å»ºæ˜¯å¯é‡çŽ°çš„

Cargo æœ‰ä¸€ä¸ªæœºåˆ¶æ¥ç¡®ä¿ä»»ä½•äººåœ¨ä»»ä½•æ—¶å€™é‡æ–°æž„å»ºä»£ç ï¼Œéƒ½ä¼šäº§ç”Ÿç›¸åŒçš„ç»“æžœï¼šCargo åªä¼šä½¿ç”¨ä½ æŒ‡å®šçš„ä¾èµ–ç‰ˆæœ¬ï¼Œé™¤éžä½ åˆæ‰‹åŠ¨æŒ‡å®šäº†åˆ«çš„ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœä¸‹å‘¨ `rand` crate çš„ `0.8.4` ç‰ˆæœ¬å‡ºæ¥äº†ï¼Œå®ƒä¿®å¤äº†ä¸€ä¸ªé‡è¦çš„ bugï¼ŒåŒæ—¶ä¹Ÿå«æœ‰ä¸€ä¸ªä¼šç ´åä»£ç è¿è¡Œçš„ç¼ºé™·ã€‚ä¸ºäº†å¤„ç†è¿™ä¸ªé—®é¢˜ï¼ŒRust åœ¨ä½ ç¬¬ä¸€æ¬¡è¿è¡Œ `cargo build` æ—¶å»ºç«‹äº† *Cargo.lock* æ–‡ä»¶ï¼Œæˆ‘ä»¬çŽ°åœ¨å¯ä»¥åœ¨ *guessing_game* ç›®å½•æ‰¾åˆ°å®ƒã€‚

å½“ç¬¬ä¸€æ¬¡æž„å»ºé¡¹ç›®æ—¶ï¼ŒCargo è®¡ç®—å‡ºæ‰€æœ‰ç¬¦åˆè¦æ±‚çš„ä¾èµ–ç‰ˆæœ¬å¹¶å†™å…¥ *Cargo.lock* æ–‡ä»¶ã€‚å½“å°†æ¥æž„å»ºé¡¹ç›®æ—¶ï¼ŒCargo ä¼šå‘çŽ° *Cargo.lock* å·²å­˜åœ¨å¹¶ä½¿ç”¨å…¶ä¸­æŒ‡å®šçš„ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯å†æ¬¡è®¡ç®—æ‰€æœ‰çš„ç‰ˆæœ¬ã€‚è¿™ä½¿å¾—ä½ æ‹¥æœ‰äº†ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„å¯é‡çŽ°çš„æž„å»ºã€‚æ¢å¥è¯è¯´ï¼Œé¡¹ç›®ä¼šæŒç»­ä½¿ç”¨ `0.8.3` ç›´åˆ°ä½ æ˜¾å¼åœ°å‡çº§ï¼Œå¤šäºæœ‰äº† *Cargo.lock* æ–‡ä»¶ã€‚

#### æ›´æ–° crate åˆ°ä¸€ä¸ªæ–°ç‰ˆæœ¬

å½“ä½ **ç¡®å®ž**éœ€è¦å‡çº§ crate æ—¶ï¼ŒCargo æä¾›äº†è¿™æ ·ä¸€ä¸ªå‘½ä»¤ `update`ï¼Œå®ƒä¼šå¿½ç•¥ *Cargo.lock* æ–‡ä»¶ï¼Œå¹¶è®¡ç®—å‡ºæ‰€æœ‰ç¬¦åˆ *Cargo.toml* å£°æ˜Žçš„æœ€æ–°ç‰ˆæœ¬ã€‚Cargo æŽ¥ä¸‹æ¥ä¼šæŠŠè¿™äº›ç‰ˆæœ¬å†™å…¥ *Cargo.lock* æ–‡ä»¶ã€‚ä¸è¿‡ï¼ŒCargo é»˜è®¤åªä¼šå¯»æ‰¾å¤§äºŽæˆ–ç­‰äºŽ `0.8.3` è€Œå°äºŽ `0.9.0` çš„ç‰ˆæœ¬ã€‚å¦‚æžœ `rand` crate å‘å¸ƒäº†ä¸¤ä¸ªæ–°ç‰ˆæœ¬ï¼Œ`0.8.4` å’Œ `0.9.0`ï¼Œåœ¨è¿è¡Œ `cargo update` æ—¶ä¼šå‡ºçŽ°å¦‚ä¸‹å†…å®¹ï¼š

```shell
cargo update
    Updating crates.io index
    Updating rand v0.8.3 -> v0.8.4
```

Cargo å¿½ç•¥äº† `0.9.0` ç‰ˆæœ¬ã€‚æ­¤æ—¶ä½ è¿˜ä¼šæ³¨æ„åˆ° *Cargo.lock* æ–‡ä»¶ä¸­å‘ç”Ÿäº†æ›´æ”¹ï¼Œ æ— éžå°±æ˜¯æ­£åœ¨ä½¿ç”¨çš„ `rand` crate ç‰ˆæœ¬æ”¹ä¸º `0.8.4`ã€‚å¦‚æžœæƒ³è¦ `rand` ä½¿ç”¨ `0.9.0` ç‰ˆæœ¬æˆ–ä»»ä½• `0.9.x` ç³»åˆ—çš„ç‰ˆæœ¬ï¼Œåˆ™å¿…é¡»åƒè¿™æ ·æ›´æ–° *Cargo.toml* æ–‡ä»¶ï¼š

```toml
[dependencies]
rand = "0.9.0"
```

ä¸‹ä¸€æ¬¡è¿è¡Œ `cargo build` æ—¶ï¼ŒCargo ä¼šä»Ž registryï¼ˆæ³¨å†Œæºï¼‰ æ›´æ–°å¯ç”¨çš„ crateï¼Œå¹¶æ ¹æ®ä½ æŒ‡å®šçš„æ–°ç‰ˆæœ¬é‡æ–°è®¡ç®—ã€‚

### ç”Ÿæˆéšæœºæ•°

æ–‡ä»¶åï¼šsrc/main.rs

```rust
use std::io;
use rand::Rng;

fn main() {
    println!("Guess the number!");

    let secret_number = rand::thread_rng().gen_range(1..101);

    println!("The secret number is: {}", secret_number);

    println!("Please input your guess.");

    let mut guess = String::new();

    io::stdin()
        .read_line(&mut guess)
        .expect("Failed to read line");

    println!("You guessed: {}", guess);
}
```

#### å¼•å…¥ rand::Rng

`Rng` æ˜¯ä¸€ä¸ª traitï¼Œå®ƒå®šä¹‰äº†éšæœºæ•°ç”Ÿæˆå™¨åº”å®žçŽ°çš„æ–¹æ³•ï¼Œæƒ³ä½¿ç”¨è¿™äº›æ–¹æ³•çš„è¯ï¼Œæ­¤ trait å¿…é¡»åœ¨ä½œç”¨åŸŸä¸­ã€‚

æˆ‘ä»¬åœ¨ä¸­é—´æ·»åŠ ä¸¤è¡Œã€‚

- åœ¨é¦–è¡Œä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨ `rand::thread_rng` å‡½æ•°æ¥ä¸ºæˆ‘ä»¬æä¾›å°†è¦ä½¿ç”¨çš„ç‰¹å®šéšæœºæ•°ç”Ÿæˆå™¨ï¼šå®ƒä½äºŽå½“å‰æ‰§è¡Œçº¿ç¨‹çš„æœ¬åœ°çŽ¯å¢ƒä¸­ï¼Œå¹¶ä»Žæ“ä½œç³»ç»ŸèŽ·å– seedã€‚
- ç„¶åŽæˆ‘ä»¬è°ƒç”¨éšæœºæ•°ç”Ÿæˆå™¨çš„ `gen_range` æ–¹æ³•ã€‚è¯¥æ–¹æ³•ç”±æˆ‘ä»¬åˆšæ‰ä½¿ç”¨ `use rand::Rng` è¯­å¥å¼•å…¥çš„ `Rng` trait å®šä¹‰ã€‚
- `gen_range` æ–¹æ³•èŽ·å¾—ä¸€ä¸ªåŒºé—´è¡¨è¾¾å¼ï¼ˆrange expressionï¼‰ä½œä¸ºå‚æ•°ï¼Œå¹¶åœ¨åŒºé—´å†…ç”Ÿæˆä¸€ä¸ªéšæœºæ•°ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨çš„åŒºé—´è¡¨è¾¾å¼é‡‡ç”¨çš„æ ¼å¼ä¸º `start..end`ã€‚å®ƒåŒ…æ‹¬èµ·å§‹ç«¯ï¼Œä½†æŽ’é™¤ç»ˆæ­¢ç«¯ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦æŒ‡å®š `1..101` ç”Ÿæˆä¸€ä¸ª 1 åˆ° 100 ä¹‹é—´çš„æ•°å­—ã€‚æˆ–è€…æˆ‘ä»¬å¯ä»¥ä¼ å…¥åŒºé—´ `1..=100`ï¼Œè¿™å’Œå‰é¢çš„è¡¨è¾¾ç­‰ä»·ã€‚

> æ³¨æ„ï¼šä½ ä¸å¯èƒ½å‡­ç©ºå°±çŸ¥é“åº”è¯¥ use å“ªä¸ª trait ä»¥åŠè¯¥ä»Ž crate ä¸­è°ƒç”¨å“ªä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥æ¯ä¸ª crate éƒ½æœ‰ä½¿ç”¨è¯´æ˜Žæ–‡æ¡£ã€‚Cargo æœ‰ä¸€ä¸ªå¾ˆæ£’çš„åŠŸèƒ½æ˜¯ï¼šè¿è¡Œ `cargo doc --open` å‘½ä»¤æ¥æž„å»ºæ‰€æœ‰æœ¬åœ°ä¾èµ–æä¾›çš„æ–‡æ¡£ï¼Œå¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ å¯¹ `rand` crate ä¸­çš„å…¶ä»–åŠŸèƒ½æ„Ÿå…´è¶£ï¼Œä½ å¯ä»¥è¿è¡Œ `cargo doc --open` å¹¶ç‚¹å‡»å·¦ä¾§å¯¼èˆªæ ä¸­çš„ `rand`ã€‚

æ–°æ·»åŠ çš„ç¬¬äºŒè¡Œä»£ç æ‰“å°å‡ºäº†ç§˜å¯†æ•°å­—ã€‚è¿™åœ¨å¼€å‘ç¨‹åºæ—¶å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå¯ä»¥æµ‹è¯•å®ƒï¼Œä¸è¿‡åœ¨æœ€ç»ˆç‰ˆæœ¬ä¸­ä¼šåˆ æŽ‰å®ƒã€‚å¦‚æžœæ¸¸æˆä¸€å¼€å§‹å°±æ‰“å°å‡ºç»“æžœå°±æ²¡ä»€ä¹ˆå¯çŽ©çš„äº†ï¼

å°è¯•è¿è¡Œç¨‹åºå‡ æ¬¡ï¼Œåº”è¯¥èƒ½å¾—åˆ°ä¸åŒçš„éšæœºæ•°ï¼ŒåŒæ—¶å®ƒä»¬åº”è¯¥éƒ½æ˜¯åœ¨ 1 å’Œ 100 ä¹‹é—´çš„ã€‚

## æ¯”è¾ƒçŒœæµ‹çš„æ•°å­—å’Œç§˜å¯†æ•°å­—

æ–‡ä»¶åï¼šsrc/main.rs

ç¤ºä¾‹ 2-4ï¼šå¤„ç†æ¯”è¾ƒä¸¤ä¸ªæ•°å­—å¯èƒ½çš„è¿”å›žå€¼

```rust
use rand::Rng;
use std::cmp::Ordering;
use std::io;

fn main() {
    // --snip--

    println!("You guessed: {}", guess);

    match guess.cmp(&secret_number) {
        Ordering::Less => println!("Too small!"),
        Ordering::Greater => println!("Too big!"),
        Ordering::Equal => println!("You win!"),
    }
}
```

### å¼•å…¥ Ordering

åŠ å…¥å¦ä¸€ä¸ª `use` å£°æ˜Žï¼Œä»Žæ ‡å‡†åº“å¼•å…¥ä¸€ä¸ªå«åš `std::cmp::Ordering` çš„ç±»åž‹åˆ°ä½œç”¨åŸŸä¸­ã€‚`Ordering` ä¹Ÿæ˜¯ä¸€ä¸ªæžšä¸¾ï¼Œä¸è¿‡å®ƒçš„æˆå‘˜æ˜¯ `Less`ã€`Greater` å’Œ `Equal`ã€‚è¿™æ˜¯æ¯”è¾ƒä¸¤ä¸ªå€¼æ—¶å¯èƒ½å‡ºçŽ°çš„ä¸‰ç§ç»“æžœã€‚

### cmp

`cmp` æ–¹æ³•ç”¨æ¥æ¯”è¾ƒä¸¤ä¸ªå€¼å¹¶å¯ä»¥åœ¨**ä»»ä½•å¯æ¯”è¾ƒçš„å€¼**ä¸Šè°ƒç”¨ã€‚

å®ƒèŽ·å–ä¸€ä¸ªè¢«æ¯”è¾ƒå€¼çš„å¼•ç”¨ï¼šè¿™é‡Œæ˜¯æŠŠ `guess` ä¸Ž `secret_number` åšæ¯”è¾ƒã€‚ ç„¶åŽå®ƒä¼šè¿”å›žä¸€ä¸ªåˆšæ‰é€šè¿‡ `use` å¼•å…¥ä½œç”¨åŸŸçš„ `Ordering` æžšä¸¾çš„æˆå‘˜ã€‚

### match

ä½¿ç”¨ä¸€ä¸ª [`match`](https://rustwiki.org/zh-CN/book/ch06-02-match.html) è¡¨è¾¾å¼ï¼Œæ ¹æ®å¯¹ `guess` å’Œ `secret_number` è°ƒç”¨ `cmp` è¿”å›žçš„ `Ordering` æˆå‘˜æ¥å†³å®šæŽ¥ä¸‹æ¥åšä»€ä¹ˆã€‚

> ä¸€ä¸ª `match` è¡¨è¾¾å¼ç”±**åˆ†æ”¯ï¼ˆarmï¼‰** æž„æˆã€‚ä¸€ä¸ªåˆ†æ”¯åŒ…å«ä¸€ä¸ªç”¨äºŽåŒ¹é…çš„**æ¨¡å¼**ï¼ˆ*pattern*ï¼‰ã€‚
>
> ç»™åˆ° `match` çš„å€¼ä¸Žåˆ†æ”¯æ¨¡å¼ç›¸åŒ¹é…æ—¶ï¼Œåº”è¯¥æ‰§è¡Œå¯¹åº”åˆ†æ”¯çš„ä»£ç ã€‚

å‡è®¾ç”¨æˆ·çŒœäº† 50ï¼Œè¿™æ—¶éšæœºç”Ÿæˆçš„ç§˜å¯†æ•°å­—æ˜¯ 38ã€‚æ¯”è¾ƒ 50 ä¸Ž 38 æ—¶ï¼Œå› ä¸º 50 æ¯” 38 è¦å¤§ï¼Œ`cmp` æ–¹æ³•ä¼šè¿”å›ž `Ordering::Greater`ã€‚`Ordering::Greater` æ˜¯ `match` è¡¨è¾¾å¼å¾—åˆ°çš„å€¼ã€‚å®ƒæ£€æŸ¥ç¬¬ä¸€ä¸ªåˆ†æ”¯çš„æ¨¡å¼ï¼Œ`Ordering::Less` ä¸Ž `Ordering::Greater`å¹¶ä¸åŒ¹é…ï¼Œæ‰€ä»¥å®ƒå¿½ç•¥äº†è¿™ä¸ªåˆ†æ”¯çš„ä»£ç å¹¶æ¥åˆ°ä¸‹ä¸€ä¸ªåˆ†æ”¯ã€‚ä¸‹ä¸€ä¸ªåˆ†æ”¯çš„æ¨¡å¼æ˜¯ `Ordering::Greater`ï¼Œ**æ­£ç¡®**åŒ¹é… `Ordering::Greater`ï¼è¿™ä¸ªåˆ†æ”¯å…³è”çš„ä»£ç è¢«æ‰§è¡Œï¼Œåœ¨å±å¹•æ‰“å°å‡º `Too big!`ã€‚`match` è¡¨è¾¾å¼å°±æ­¤ç»ˆæ­¢ï¼Œå› ä¸ºè¯¥åœºæ™¯ä¸‹æ²¡æœ‰æ£€æŸ¥æœ€åŽä¸€ä¸ªåˆ†æ”¯çš„å¿…è¦ã€‚

### ä¸åŒ¹é…çš„ç±»åž‹

ç¤ºä¾‹ 2-4 çš„ä»£ç å¹¶ä¸èƒ½ç¼–è¯‘ï¼Œå¯ä»¥å°è¯•ä¸€ä¸‹ï¼š

```shell
$ cargo build
   Compiling libc v0.2.86
   Compiling getrandom v0.2.2
   Compiling cfg-if v1.0.0
   Compiling ppv-lite86 v0.2.10
   Compiling rand_core v0.6.2
   Compiling rand_chacha v0.3.0
   Compiling rand v0.8.3
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
error[E0308]: mismatched types
  --> src/main.rs:22:21
   |
22 |     match guess.cmp(&secret_number) {
   |                     ^^^^^^^^^^^^^^ expected struct `String`, found integer
   |
   = note: expected reference `&String`
              found reference `&{integer}`

error[E0283]: type annotations needed for `{integer}`
   --> src/main.rs:8:44
    |
8   |     let secret_number = rand::thread_rng().gen_range(1..101);
    |         -------------                      ^^^^^^^^^ cannot infer type for type `{integer}`
    |         |
    |         consider giving `secret_number` a type
    |
    = note: multiple `impl`s satisfying `{integer}: SampleUniform` found in the `rand` crate:
            - impl SampleUniform for i128;
            - impl SampleUniform for i16;
            - impl SampleUniform for i32;
            - impl SampleUniform for i64;
            and 8 more
note: required by a bound in `gen_range`
   --> /Users/carolnichols/.cargo/registry/src/github.com-1ecc6299db9ec823/rand-0.8.3/src/rng.rs:129:12
    |
129 |         T: SampleUniform,
    |            ^^^^^^^^^^^^^ required by this bound in `gen_range`
help: consider specifying the type arguments in the function call
    |
8   |     let secret_number = rand::thread_rng().gen_range::<T, R>(1..101);
    |                                                     ++++++++

Some errors have detailed explanations: E0283, E0308.
For more information about an error, try `rustc --explain E0283`.
error: could not compile `guessing_game` due to 2 previous errors

```

é”™è¯¯çš„æ ¸å¿ƒè¡¨æ˜Žè¿™é‡Œæœ‰**ä¸åŒ¹é…çš„ç±»åž‹**ï¼ˆ*mismatched type*ï¼‰ã€‚

Rust æœ‰ä¸€ä¸ª**é™æ€å¼ºç±»åž‹**ç³»ç»Ÿï¼ŒåŒæ—¶ä¹Ÿæœ‰**ç±»åž‹æŽ¨æ–­**ã€‚

> å½“æˆ‘ä»¬å†™å‡º `let guess = String::new()` æ—¶ï¼ŒRust æŽ¨æ–­å‡º `guess` åº”è¯¥æ˜¯ `String` ç±»åž‹ï¼Œå¹¶ä¸éœ€è¦æˆ‘ä»¬å†™å‡ºç±»åž‹ã€‚
>
> `secret_number` æ˜¯æ•°å­—ç±»åž‹ã€‚Rust ä¸­æœ‰å¥½å‡ ç§æ•°å­—ç±»åž‹æ‹¥æœ‰ 1 åˆ° 100 ä¹‹é—´çš„å€¼ï¼š32 ä½æ•°å­— `i32`ã€32 ä½æ— ç¬¦å·æ•°å­— `u32`ã€64 ä½æ•°å­— `i64`ï¼Œç­‰ç­‰ã€‚Rust é»˜è®¤ä½¿ç”¨ `i32`ï¼Œè¿™æ˜¯ `secret_number` çš„ç±»åž‹ï¼Œé™¤éžé¢å¤–æŒ‡å®šç±»åž‹ä¿¡æ¯ï¼Œæˆ–ä»»ä½•èƒ½è®© Rust æŽ¨æ–­å‡ºä¸åŒæ•°å€¼ç±»åž‹çš„ä¿¡æ¯ã€‚

è¿™é‡Œé”™è¯¯çš„åŽŸå› åœ¨äºŽ Rust ä¸ä¼šæ¯”è¾ƒå­—ç¬¦ä¸²ç±»åž‹å’Œæ•°å­—ç±»åž‹ã€‚

æ‰€ä»¥æˆ‘ä»¬å¿…é¡»æŠŠä»Žè¾“å…¥ä¸­è¯»å–åˆ°çš„ `String` è½¬æ¢ä¸ºä¸€ä¸ªçœŸæ­£çš„æ•°å­—ç±»åž‹ï¼Œæ‰å¥½ä¸Žç§˜å¯†æ•°å­—è¿›è¡Œæ¯”è¾ƒã€‚

### ç±»åž‹è½¬æ¢

```rust
    // --snip--

    let mut guess = String::new();

    io::stdin()
        .read_line(&mut guess)
        .expect("Failed to read line");

    let guess: u32 = guess.trim().parse().expect("Please type a number!");

    println!("You guessed: {}", guess);

    match guess.cmp(&secret_number) {
        Ordering::Less => println!("Too small!"),
        Ordering::Greater => println!("Too big!"),
        Ordering::Equal => println!("You win!"),
    }
```

ç±»åž‹è½¬æ¢çš„ä»£ç ï¼š

```rust
let guess: u32 = guess.trim().parse().expect("Please type a number!");
```

#### é®è”½

è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªå«åš `guess` çš„å˜é‡ã€‚

> Rust å…è®¸ç”¨ä¸€ä¸ªæ–°å€¼æ¥**é®è”½** ï¼ˆ*shadow*ï¼‰ `guess` ä¹‹å‰çš„å€¼ã€‚è¿™å…è®¸æˆ‘ä»¬å¤ç”¨ `guess` å˜é‡çš„åå­—ï¼Œè€Œä¸æ˜¯è¢«è¿«åˆ›å»ºä¸¤ä¸ªä¸åŒå˜é‡ï¼Œè¯¸å¦‚ `guess_str` å’Œ `guess` ä¹‹ç±»ã€‚

#### trim()

æˆ‘ä»¬å°†è¿™ä¸ªæ–°å˜é‡ç»‘å®šåˆ° `guess.trim().parse()` è¡¨è¾¾å¼ä¸Šã€‚è¡¨è¾¾å¼ä¸­çš„ `guess` æ˜¯æŒ‡åŽŸå§‹çš„ `guess` å˜é‡ï¼Œå…¶ä¸­åŒ…å«ä½œä¸ºå­—ç¬¦ä¸²çš„è¾“å…¥ã€‚

> `String` å®žä¾‹çš„ `trim` æ–¹æ³•ä¼šåŽ»é™¤å­—ç¬¦ä¸²å¼€å¤´å’Œç»“å°¾çš„ç©ºç™½å­—ç¬¦ï¼Œæˆ‘ä»¬å¿…é¡»æ‰§è¡Œæ­¤æ–¹æ³•æ‰èƒ½å°†å­—ç¬¦ä¸²ä¸Ž `u32` æ¯”è¾ƒï¼Œå› ä¸º `u32` åªèƒ½åŒ…å«æ•°å€¼åž‹æ•°æ®ã€‚
>
> ç”¨æˆ·å¿…é¡»è¾“å…¥ enter é”®æ‰èƒ½è®© `read_line` è¿”å›žï¼Œå¹¶è¾“å…¥ä»–ä»¬çš„çŒœæƒ³ï¼Œè¿™ä¼šåœ¨å­—ç¬¦ä¸²ä¸­å¢žåŠ ä¸€ä¸ªæ¢è¡Œç¬¦ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·è¾“å…¥ 5 å¹¶æŒ‰ä¸‹ enterï¼Œ`guess` çœ‹èµ·æ¥åƒè¿™æ ·ï¼š`5\n`ï¼Œ`\n` ä»£è¡¨ â€œæ¢è¡Œâ€ï¼ˆåœ¨ Windows ä¸­ï¼ŒæŒ‰ enter é”®ä¼šå¾—åˆ°ä¸€ä¸ªå›žè½¦å’Œä¸€ä¸ªæ¢è¡Œç¬¦ `\r\n`ï¼‰ã€‚`trim` æ–¹æ³•ä¼šæ¶ˆé™¤ `\n` æˆ– `\r\n`ï¼Œåªç•™ä¸‹ `5`ã€‚

#### parse()

[å­—ç¬¦ä¸²çš„ `parse` æ–¹æ³•](https://rustwiki.org/zh-CN/std/primitive.str.html#method.parse) å°†å­—ç¬¦ä¸²è§£æžæˆæ•°å­—ã€‚å› ä¸ºè¿™ä¸ªæ–¹æ³•å¯ä»¥è§£æžå¤šç§æ•°å­—ç±»åž‹ï¼Œå› æ­¤éœ€è¦å‘Šè¯‰ Rust å…·ä½“çš„æ•°å­—ç±»åž‹ï¼Œè¿™é‡Œé€šè¿‡ `let guess: u32` æŒ‡å®šã€‚`guess` åŽé¢çš„å†’å·ï¼ˆ`:`ï¼‰å‘Šè¯‰ Rust æˆ‘ä»¬æŒ‡å®šäº†å˜é‡çš„ç±»åž‹ã€‚Rust æœ‰ä¸€äº›å†…å»ºçš„æ•°å­—ç±»åž‹ï¼›`u32` æ˜¯ä¸€ä¸ªæ— ç¬¦å·çš„ 32 ä½æ•´åž‹ã€‚å¯¹äºŽä¸å¤§çš„æ­£æ•´æ•°æ¥è¯´ï¼Œå®ƒæ˜¯ä¸é”™çš„ç±»åž‹ã€‚å¦å¤–ï¼Œç¨‹åºä¸­çš„ `u32` æ ‡æ³¨ä»¥åŠä¸Ž `secret_number` çš„æ¯”è¾ƒï¼Œæ„å‘³ç€ Rust ä¼šæŽ¨æ–­å‡º `secret_number` ä¹Ÿæ˜¯ `u32` ç±»åž‹ã€‚

#### æ½œåœ¨é”™è¯¯å¤„ç†

ç”±äºŽ `parse` æ–¹æ³•åªèƒ½ç”¨äºŽå¯ä»¥é€»è¾‘è½¬æ¢ä¸ºæ•°å­—çš„å­—ç¬¦ï¼Œæ‰€ä»¥è°ƒç”¨å®ƒå¾ˆå®¹æ˜“äº§ç”Ÿé”™è¯¯ã€‚ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸²ä¸­åŒ…å« `AðŸ‘%`ï¼Œå°±æ— æ³•å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªæ•°å­—ã€‚å› æ­¤ï¼Œ`parse` æ–¹æ³•è¿”å›žä¸€ä¸ª `Result` ç±»åž‹ã€‚åƒå‰é¢ [â€œä½¿ç”¨ `Result` ç±»åž‹æ¥å¤„ç†æ½œåœ¨çš„é”™è¯¯â€](https://rustwiki.org/zh-CN/book/ch02-00-guessing-game-tutorial.html#ä½¿ç”¨-result-ç±»åž‹æ¥å¤„ç†æ½œåœ¨çš„é”™è¯¯) éƒ¨åˆ†è®¨è®ºçš„ `read_line` æ–¹æ³•é‚£æ ·ï¼Œå†æ¬¡æŒ‰éƒ¨å°±ç­åœ°ç”¨ `expect` æ–¹æ³•å¤„ç†å³å¯ã€‚å¦‚æžœ `parse` ä¸èƒ½ä»Žå­—ç¬¦ä¸²ç”Ÿæˆä¸€ä¸ªæ•°å­—ï¼Œè¿”å›žä¸€ä¸ª `Result` çš„ `Err` æˆå‘˜æ—¶ï¼Œ`expect` ä¼šä½¿æ¸¸æˆå´©æºƒå¹¶æ‰“å°é™„å¸¦çš„ä¿¡æ¯ã€‚å¦‚æžœ `parse` æˆåŠŸåœ°å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸€ä¸ªæ•°å­—ï¼Œå®ƒä¼šè¿”å›ž `Result` çš„ `Ok` æˆå‘˜ï¼Œç„¶åŽ `expect` ä¼šè¿”å›ž `Ok` å€¼ä¸­çš„æ•°å­—ã€‚

#### æ­£ç¡®è¿è¡Œ

```shell
$ cargo run
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
    Finished dev [unoptimized + debuginfo] target(s) in 0.43s
     Running `target/debug/guessing_game`
Guess the number!
The secret number is: 58
Please input your guess.
  76
You guessed: 76
Too big!
```

## ä½¿ç”¨å¾ªçŽ¯æ¥å…è®¸å¤šæ¬¡çŒœæµ‹

æ–‡ä»¶åï¼šsrc/main.rs

```rust
    // --snip--

    println!("The secret number is: {}", secret_number);

    loop {
        println!("Please input your guess.");

        // --snip--

        match guess.cmp(&secret_number) {
            Ordering::Less => println!("Too small!"),
            Ordering::Greater => println!("Too big!"),
            Ordering::Equal => println!("You win!"),
        }
    }
}
```

### loop

`loop` å…³é”®å­—åˆ›å»ºäº†ä¸€ä¸ª**æ— é™å¾ªçŽ¯**ã€‚æˆ‘ä»¬å¢žåŠ å¾ªçŽ¯æ¥ç»™ç”¨æˆ·æ›´å¤šçŒœæ•°å­—çš„æœºä¼šã€‚

### æ„å¤–é€€å‡º

ç”¨æˆ·æ€»èƒ½ä½¿ç”¨ ctrl-c ç»ˆæ­¢ç¨‹åºã€‚ä¸è¿‡è¿˜æœ‰å¦ä¸€ä¸ªæ–¹æ³•è·³å‡ºæ— é™å¾ªçŽ¯ï¼Œå°±æ˜¯[â€œæ¯”è¾ƒçŒœæµ‹çš„æ•°å­—å’Œç§˜å¯†æ•°å­—â€](https://rustwiki.org/zh-CN/book/ch02-00-guessing-game-tutorial.html#æ¯”è¾ƒçŒœæµ‹çš„æ•°å­—å’Œç§˜å¯†æ•°å­—)éƒ¨åˆ†æåˆ°çš„ `parse`ï¼šå¦‚æžœç”¨æˆ·è¾“å…¥çš„ç­”æ¡ˆä¸æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œç¨‹åºä¼šå´©æºƒã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹æ¥é€€å‡ºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```shell
$ cargo run
   Compiling guessing_game v0.1.0 (file:///projects/guessing_game)
    Finished dev [unoptimized + debuginfo] target(s) in 1.50s
     Running `target/debug/guessing_game`
Guess the number!
The secret number is: 59
Please input your guess.
45
You guessed: 45
Too small!
Please input your guess.
60
You guessed: 60
Too big!
Please input your guess.
59
You guessed: 59
You win!
Please input your guess.
quit
thread 'main' panicked at 'Please type a number!: ParseIntError { kind: InvalidDigit }', src/main.rs:28:47
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
```

è¾“å…¥ `quit` å°†ä¼šé€€å‡ºç¨‹åºï¼ŒåŒæ—¶ä½ ä¼šæ³¨æ„åˆ°è¾“å…¥å…¶ä»–ä»»ä½•éžæ•°å­—ä¹Ÿä¸€æ ·ã€‚ç„¶è€Œï¼Œè¿™å¹¶ä¸ç†æƒ³ï¼Œæˆ‘ä»¬æƒ³è¦å½“çŒœæµ‹æ­£ç¡®çš„æ•°å­—æ—¶æ¸¸æˆä¹Ÿèƒ½è‡ªåŠ¨é€€å‡ºã€‚

### çŒœæµ‹æ­£ç¡®åŽé€€å‡º

æ–‡ä»¶åï¼šsrc/main.rs

```rust
        // --snip--

        match guess.cmp(&secret_number) {
            Ordering::Less => println!("Too small!"),
            Ordering::Greater => println!("Too big!"),
            Ordering::Equal => {
                println!("You win!");
                break;
            }
        }
    }
}
```

é€šè¿‡åœ¨ `You win!` ä¹‹åŽå¢žåŠ ä¸€è¡Œ `break`ï¼Œç”¨æˆ·çŒœå¯¹äº†ç¥žç§˜æ•°å­—åŽä¼šé€€å‡ºå¾ªçŽ¯ã€‚é€€å‡ºå¾ªçŽ¯ä¹Ÿæ„å‘³ç€é€€å‡ºç¨‹åºï¼Œå› ä¸ºå¾ªçŽ¯æ˜¯ `main` çš„æœ€åŽä¸€éƒ¨åˆ†ã€‚

### å¤„ç†æ— æ•ˆè¾“å…¥

æ–‡ä»¶åï¼šsrc/main.rs

```rust
        // --snip--

        io::stdin()
            .read_line(&mut guess)
            .expect("Failed to read line");

        let guess: u32 = match guess.trim().parse() {
            Ok(num) => num,
            Err(_) => continue,
        };

        println!("You guessed: {}", guess);

        // --snip--
```

æˆ‘ä»¬å°† `expect` è°ƒç”¨æ¢æˆ `match` è¯­å¥ï¼Œä»Žè€Œå®žçŽ°é‡åˆ°é”™è¯¯å°±å´©æºƒè½¬æ¢æˆå¤„ç†é”™è¯¯ã€‚é¡»çŸ¥ `parse` è¿”å›žä¸€ä¸ª `Result` ç±»åž‹ï¼Œè€Œ `Result` æ˜¯ä¸€ä¸ªæ‹¥æœ‰ `Ok` æˆ– `Err` æˆå‘˜çš„æžšä¸¾ã€‚è¿™é‡Œä½¿ç”¨çš„ `match` è¡¨è¾¾å¼ï¼Œå’Œä¹‹å‰å¤„ç† `cmp` æ–¹æ³•è¿”å›ž `Ordering` æ—¶ç”¨çš„ä¸€æ ·ã€‚

å¦‚æžœ `parse` èƒ½å¤ŸæˆåŠŸçš„å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸€ä¸ªæ•°å­—ï¼Œå®ƒä¼šè¿”å›žä¸€ä¸ªåŒ…å«ç»“æžœæ•°å­—çš„ `Ok`ã€‚è¿™ä¸ª `Ok` å€¼ä¸Ž `match` ç¬¬ä¸€ä¸ªåˆ†æ”¯çš„æ¨¡å¼ç›¸åŒ¹é…ï¼Œè¯¥åˆ†æ”¯å¯¹åº”çš„åŠ¨ä½œè¿”å›ž `Ok` å€¼ä¸­çš„æ•°å­— `num`ï¼Œæœ€åŽå¦‚æ„¿å˜æˆæ–°åˆ›å»ºçš„ `guess` å˜é‡ã€‚

å¦‚æžœ `parse` **ä¸**èƒ½å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸€ä¸ªæ•°å­—ï¼Œå®ƒä¼šè¿”å›žä¸€ä¸ªåŒ…å«æ›´å¤šé”™è¯¯ä¿¡æ¯çš„ `Err`ã€‚`Err` å€¼ä¸èƒ½åŒ¹é…ç¬¬ä¸€ä¸ª `match` åˆ†æ”¯çš„ `Ok(num)` æ¨¡å¼ï¼Œä½†æ˜¯ä¼šåŒ¹é…ç¬¬äºŒä¸ªåˆ†æ”¯çš„ `Err(_)` æ¨¡å¼ï¼š`_` æ˜¯ä¸€ä¸ªé€šé…ç¬¦å€¼ï¼Œæœ¬ä¾‹ä¸­ç”¨æ¥åŒ¹é…æ‰€æœ‰ `Err` å€¼ï¼Œä¸ç®¡å…¶ä¸­æœ‰ä½•ç§ä¿¡æ¯ã€‚æ‰€ä»¥ç¨‹åºä¼šæ‰§è¡Œç¬¬äºŒä¸ªåˆ†æ”¯çš„åŠ¨ä½œï¼Œ`continue` æ„å‘³ç€è¿›å…¥ `loop` çš„ä¸‹ä¸€æ¬¡å¾ªçŽ¯ï¼Œè¯·æ±‚å¦ä¸€ä¸ªçŒœæµ‹ã€‚è¿™æ ·ç¨‹åºå°±æœ‰æ•ˆçš„å¿½ç•¥äº† `parse` å¯èƒ½é‡åˆ°çš„æ‰€æœ‰é”™è¯¯ï¼

## å®Œæ•´ä»£ç 

```rust
use rand::Rng;
use std::cmp::Ordering;
use std::io;

fn main() {
    println!("Guess the number!");

    let secret_number = rand::thread_rng().gen_range(1..101);

    loop {
        println!("Please input your guess.");

        let mut guess = String::new();

        io::stdin()
            .read_line(&mut guess)
            .expect("Failed to read line");

        let guess: u32 = match guess.trim().parse() {
            Ok(num) => num,
            Err(_) => continue,
        };

        println!("You guessed: {}", guess);

        match guess.cmp(&secret_number) {
            Ordering::Less => println!("Too small!"),
            Ordering::Greater => println!("Too big!"),
            Ordering::Equal => {
                println!("You win!");
                break;
            }
        }
    }
}
```

